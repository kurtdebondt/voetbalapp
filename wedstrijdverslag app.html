<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedstrijdverslag Jeugdvoetbal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
        }
        ::-webkit-scrollbar-thumb {
            background: #34d399;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #10b981;
        }
        .player-chip {
            cursor: grab;
            user-select: none;
            transition: transform 0.1s ease-in-out;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .player-chip:active {
            cursor: grabbing;
        }
        #pitch-svg {
            background-color: #1a4d1a;
            border-radius: 0.5rem;
            width: 100%;
            height: 400px;
            touch-action: none;
        }
        #playersOnPitch .draggable-player {
            cursor: grab;
            user-select: none;
            transition: all 0.1s ease-in-out;
        }
        .draggable-player:hover {
            transform: scale(1.1);
        }
        .player-placeholder {
            border: 2px dashed #90EE90;
        }
    </style>
</head>
<body class="p-4 sm:p-8 flex flex-col items-center justify-center min-h-screen bg-gray-100 text-gray-800">
    <div class="bg-white rounded-xl shadow-lg p-6 sm:p-8 max-w-3xl w-full">
        <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6 text-green-600">Wedstrijdverslag Jeugdvoetbal</h1>
        
        <!-- Formulier voor het invoeren van het verslag -->
        <div id="report-form" class="space-y-6">
            <!-- Wedstrijddetails sectie -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700">Wedstrijdgegevens</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="matchDate" class="block text-sm font-medium text-gray-700 mb-1">Datum</label>
                        <input type="date" id="matchDate" class="w-full p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                    </div>
                    <div>
                        <label for="opponent" class="block text-sm font-medium text-gray-700 mb-1">Tegenstander</label>
                        <input type="text" id="opponent" placeholder="Naam tegenstander" class="w-full p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                    </div>
                    <div>
                        <label for="homeScore" class="block text-sm font-medium text-gray-700 mb-1">Score eigen ploeg</label>
                        <input type="number" id="homeScore" value="0" min="0" class="w-full p-2 border border-gray-300 rounded-md bg-gray-200" readonly>
                    </div>
                    <div>
                        <label for="awayScore" class="block text-sm font-medium text-gray-700 mb-1">Score tegenstander</label>
                        <input type="number" id="awayScore" value="0" min="0" class="w-full p-2 border border-gray-300 rounded-md bg-gray-200" readonly>
                    </div>
                </div>
            </div>

            <!-- Score per kwartier sectie -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700">Score per kwartier</h2>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-center">
                    <div>
                        <p class="font-medium">1e Kwart</p>
                        <div class="flex gap-2 mt-1">
                            <input type="number" id="q1HomeScore" value="0" min="0" class="quarter-score-input w-1/2 p-2 text-center border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                            <input type="number" id="q1AwayScore" value="0" min="0" class="quarter-score-input w-1/2 p-2 text-center border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                        </div>
                    </div>
                    <div>
                        <p class="font-medium">2e Kwart</p>
                        <div class="flex gap-2 mt-1">
                            <input type="number" id="q2HomeScore" value="0" min="0" class="quarter-score-input w-1/2 p-2 text-center border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                            <input type="number" id="q2AwayScore" value="0" min="0" class="quarter-score-input w-1/2 p-2 text-center border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                        </div>
                    </div>
                    <div>
                        <p class="font-medium">3e Kwart</p>
                        <div class="flex gap-2 mt-1">
                            <input type="number" id="q3HomeScore" value="0" min="0" class="quarter-score-input w-1/2 p-2 text-center border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                            <input type="number" id="q3AwayScore" value="0" min="0" class="quarter-score-input w-1/2 p-2 text-center border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                        </div>
                    </div>
                    <div>
                        <p class="font-medium">4e Kwart</p>
                        <div class="flex gap-2 mt-1">
                            <input type="number" id="q4HomeScore" value="0" min="0" class="quarter-score-input w-1/2 p-2 text-center border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                            <input type="number" id="q4AwayScore" value="0" min="0" class="quarter-score-input w-1/2 p-2 text-center border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Algemene opmerkingen sectie -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700">Algemene opmerkingen</h2>
                <textarea id="generalComments" rows="4" placeholder="Algemene indruk van de wedstrijd, hoogtepunten, aandachtspunten..." class="w-full p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"></textarea>
            </div>

            <!-- Spelers sectie -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <h2 class="text-2xl font-semibold mb-4 flex justify-between items-center text-gray-700">
                    Spelerbeoordelingen
                    <button id="addPlayerBtn" class="bg-green-500 text-white p-2 rounded-full shadow-md hover:bg-green-600 transition-colors">+</button>
                </h2>
                <div id="playersContainer" class="space-y-4">
                    <!-- Standaard speler invoer veld -->
                    <div class="player-input flex flex-col sm:flex-row gap-2">
                        <input type="text" placeholder="Spelernaam" class="player-name w-full sm:w-1/3 p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                        <input type="text" placeholder="Opmerking over de speler" class="player-comment w-full sm:w-2/3 p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                    </div>
                </div>
            </div>

            <!-- Kwart-indeling en spelerposities sectie -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700">Kwart-indeling en Spelerposities</h2>
                <div class="flex items-center mb-4 gap-4">
                    <label for="quarterSelect" class="font-medium text-gray-700">Kwartier:</label>
                    <select id="quarterSelect" class="p-2 border border-gray-300 rounded-md">
                        <option value="q1">1e Kwart</option>
                        <option value="q2">2e Kwart</option>
                        <option value="q3">3e Kwart</option>
                        <option value="q4">4e Kwart</option>
                    </select>
                </div>
                <div class="flex flex-col md:flex-row gap-4">
                    <div id="playerChipsContainer" class="md:w-1/4 flex flex-wrap gap-2 md:h-[400px] md:overflow-y-auto p-2 bg-gray-100 rounded-md">
                        <!-- Spelerchips worden hier dynamisch toegevoegd -->
                    </div>
                    <div class="md:w-3/4 relative">
                        <svg id="pitch-svg" viewBox="0 0 100 65" xmlns="http://www.w3.org/2000/svg">
                            <!-- Voetbalveld lijnen -->
                            <rect x="0" y="0" width="100" height="65" fill="#1a4d1a" stroke="#fff" stroke-width="0.5" />
                            <line x1="50" y1="0" x2="50" y2="65" stroke="#fff" stroke-width="0.5" />
                            <circle cx="50" cy="32.5" r="7.3" stroke="#fff" fill="none" stroke-width="0.5" />
                            <circle cx="50" cy="32.5" r="0.5" fill="#fff" />
                            <rect x="0" y="20.5" width="16.5" height="24" fill="#1a4d1a" stroke="#fff" stroke-width="0.5" />
                            <rect x="0" y="26.5" width="5.5" height="12" fill="#1a4d1a" stroke="#fff" stroke-width="0.5" />
                            <rect x="83.5" y="20.5" width="16.5" height="24" fill="#1a4d1a" stroke="#fff" stroke-width="0.5" />
                            <rect x="94.5" y="26.5" width="5.5" height="12" fill="#1a4d1a" stroke="#fff" stroke-width="0.5" />
                            <path d="M 16.5 20.5 A 7.3 7.3 0 0 1 16.5 44.5" fill="none" stroke="#fff" stroke-width="0.5"/>
                            <path d="M 83.5 20.5 A 7.3 7.3 0 0 0 83.5 44.5" fill="none" stroke="#fff" stroke-width="0.5"/>
                            <g id="playersOnPitch"></g>
                        </svg>
                        <div id="touch-overlay" class="absolute inset-0 z-10 hidden"></div>
                    </div>
                </div>
            </div>

            <!-- Knoppen sectie -->
            <div class="flex flex-col sm:flex-row gap-4 mt-6">
                <button id="saveReportBtn" class="w-full sm:w-1/2 bg-green-600 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-green-700 transition-colors">Rapport Opslaan</button>
                <button id="clearFormBtn" class="w-full sm:w-1/2 bg-red-500 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-red-600 transition-colors">Formulier Wissen</button>
            </div>
        </div>

        <!-- Bevestigingsmodal -->
        <div id="confirmationModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-lg p-6 shadow-xl w-full max-w-sm">
                <p id="modalMessage" class="text-lg font-medium text-gray-800 mb-4"></p>
                <div class="flex justify-end gap-2">
                    <button id="modalConfirmBtn" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">OK</button>
                    <button id="modalCancelBtn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-400">Annuleren</button>
                </div>
            </div>
        </div>

        <!-- Weergave van opgeslagen verslagen -->
        <div id="savedReportsSection" class="mt-8 bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold mb-4 text-green-600 text-center">Opgeslagen Verslagen</h2>
            <div id="reportsList" class="space-y-4">
                <p id="noReportsMsg" class="text-center text-gray-500 italic">Er zijn nog geen verslagen opgeslagen.</p>
            </div>
        </div>
    </div>

    <script>
        // Functie om de HTML-elementen op te halen
        const getEl = (id) => document.getElementById(id);

        // Ophalen van alle benodigde elementen
        const matchDateInput = getEl('matchDate');
        const opponentInput = getEl('opponent');
        const homeScoreInput = getEl('homeScore');
        const awayScoreInput = getEl('awayScore');
        const generalCommentsInput = getEl('generalComments');
        const playersContainer = getEl('playersContainer');
        const addPlayerBtn = getEl('addPlayerBtn');
        const saveReportBtn = getEl('saveReportBtn');
        const clearFormBtn = getEl('clearFormBtn');
        const reportsList = getEl('reportsList');
        const noReportsMsg = getEl('noReportsMsg');
        const confirmationModal = getEl('confirmationModal');
        const modalMessage = getEl('modalMessage');
        const modalConfirmBtn = getEl('modalConfirmBtn');
        const modalCancelBtn = getEl('modalCancelBtn');

        const quarterSelect = getEl('quarterSelect');
        const playersOnPitch = getEl('playersOnPitch');
        const playerChipsContainer = getEl('playerChipsContainer');
        const pitchSvg = getEl('pitch-svg');
        const touchOverlay = getEl('touch-overlay');

        const quarterScoreInputs = {
            q1Home: getEl('q1HomeScore'),
            q1Away: getEl('q1AwayScore'),
            q2Home: getEl('q2HomeScore'),
            q2Away: getEl('q2AwayScore'),
            q3Home: getEl('q3HomeScore'),
            q3Away: getEl('q3AwayScore'),
            q4Home: getEl('q4HomeScore'),
            q4Away: getEl('q4AwayScore'),
        };

        // State voor de spelerposities per kwartier en de scores per kwartier
        let quarterPositions = {
            'q1': [],
            'q2': [],
            'q3': [],
            'q4': []
        };
        let quarterScores = {
            'q1': { home: 0, away: 0 },
            'q2': { home: 0, away: 0 },
            'q3': { home: 0, away: 0 },
            'q4': { home: 0, away: 0 }
        };
        let draggingPlayer = null;

        // Functie om de totale score te berekenen en weer te geven
        const calculateTotalScore = () => {
            let totalHomeScore = 0;
            let totalAwayScore = 0;
            for (const q in quarterScores) {
                totalHomeScore += parseInt(quarterScores[q].home) || 0;
                totalAwayScore += parseInt(quarterScores[q].away) || 0;
            }
            homeScoreInput.value = totalHomeScore;
            awayScoreInput.value = totalAwayScore;
        };

        // Functie om een nieuw spelerinvoerblok toe te voegen
        const addPlayerInput = (playerName = '', playerComment = '') => {
            const playerDiv = document.createElement('div');
            playerDiv.className = 'player-input flex flex-col sm:flex-row gap-2 items-center';
            playerDiv.innerHTML = `
                <input type="text" placeholder="Spelernaam" value="${playerName}" class="player-name w-full sm:w-1/3 p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                <input type="text" placeholder="Opmerking over de speler" value="${playerComment}" class="player-comment w-full sm:w-2/3 p-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500">
                <button class="remove-player-btn bg-red-500 text-white p-2 rounded-full shadow-md hover:bg-red-600 transition-colors text-xs flex-shrink-0 w-8 h-8 flex items-center justify-center mt-2 sm:mt-0">X</button>
            `;
            playersContainer.appendChild(playerDiv);

            updatePlayerChips();
        };

        // Functie om een bevestigingsmodal te tonen
        const showConfirmationModal = (message, onConfirm) => {
            modalMessage.textContent = message;
            confirmationModal.classList.remove('hidden');

            modalConfirmBtn.onclick = () => {
                onConfirm();
                confirmationModal.classList.add('hidden');
            };

            modalCancelBtn.onclick = () => {
                confirmationModal.classList.add('hidden');
            };
        };

        // Functie om het formulier te wissen
        const clearForm = () => {
            matchDateInput.value = '';
            opponentInput.value = '';
            homeScoreInput.value = '0';
            awayScoreInput.value = '0';
            generalCommentsInput.value = '';
            playersContainer.innerHTML = '';
            quarterPositions = { 'q1': [], 'q2': [], 'q3': [], 'q4': [] };
            quarterScores = { 'q1': { home: 0, away: 0 }, 'q2': { home: 0, away: 0 }, 'q3': { home: 0, away: 0 }, 'q4': { home: 0, away: 0 } };
            for (const key in quarterScoreInputs) {
                quarterScoreInputs[key].value = 0;
            }
            quarterSelect.value = 'q1';
            addPlayerInput();
            renderPlayersOnPitch();
            calculateTotalScore();
        };

        // Functie om opgeslagen verslagen te laden en weer te geven
        const loadReports = () => {
            const savedReports = JSON.parse(localStorage.getItem('matchReports')) || [];
            reportsList.innerHTML = '';
            if (savedReports.length === 0) {
                noReportsMsg.classList.remove('hidden');
            } else {
                noReportsMsg.classList.add('hidden');
                savedReports.forEach((report, index) => {
                    const reportDiv = document.createElement('div');
                    reportDiv.className = 'bg-gray-100 p-4 rounded-lg shadow-sm cursor-pointer hover:bg-gray-200 transition-colors flex justify-between items-center';
                    reportDiv.innerHTML = `
                        <div class="flex-grow">
                            <h3 class="text-lg font-semibold text-green-700">${report.matchDate} - ${report.opponent}</h3>
                            <p class="text-sm text-gray-600">${report.homeScore} - ${report.awayScore}</p>
                        </div>
                        <div class="flex gap-2">
                           <button class="view-report-btn bg-blue-500 text-white px-3 py-1 rounded-md text-xs hover:bg-blue-600 transition-colors" data-index="${index}">Bekijken</button>
                           <button class="delete-report-btn bg-red-500 text-white px-3 py-1 rounded-md text-xs hover:bg-red-600 transition-colors" data-index="${index}">Verwijderen</button>
                        </div>
                    `;
                    reportsList.appendChild(reportDiv);
                });
            }
        };

        // Functie om de spelerchips te updaten in het drag-and-drop gedeelte
        const updatePlayerChips = () => {
            const playerNames = Array.from(document.querySelectorAll('.player-name')).map(input => input.value).filter(name => name.trim() !== '');
            playerChipsContainer.innerHTML = '';
            playerNames.forEach(name => {
                const chip = document.createElement('div');
                chip.textContent = name;
                chip.className = 'player-chip bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold cursor-grab';
                chip.draggable = true;
                chip.dataset.playerName = name;
                playerChipsContainer.appendChild(chip);
            });
        };

        // Functie om de spelers op het veld te renderen
        const renderPlayersOnPitch = () => {
            playersOnPitch.innerHTML = '';
            const currentQuarter = quarterSelect.value;
            const players = quarterPositions[currentQuarter] || [];

            players.forEach(player => {
                const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                group.className.baseVal = 'draggable-player';
                group.setAttribute('transform', `translate(${player.x}, ${player.y})`);
                group.dataset.playerName = player.name;

                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('r', '2.5');
                circle.setAttribute('fill', '#fff');
                circle.setAttribute('stroke', '#000');
                circle.setAttribute('stroke-width', '0.2');

                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.textContent = player.name.substring(0, 3).toUpperCase();
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'central');
                text.setAttribute('fill', '#000');
                text.setAttribute('font-size', '1.5');
                text.setAttribute('font-weight', 'bold');

                group.appendChild(circle);
                group.appendChild(text);
                playersOnPitch.appendChild(group);
            });
        };

        // Functie om spelerposities te updaten
        const updatePlayerPosition = (playerName, x, y) => {
            const currentQuarter = quarterSelect.value;
            const quarterData = quarterPositions[currentQuarter];
            const existingPlayerIndex = quarterData.findIndex(p => p.name === playerName);
            
            if (existingPlayerIndex > -1) {
                quarterData[existingPlayerIndex].x = x;
                quarterData[existingPlayerIndex].y = y;
            } else {
                quarterData.push({ name: playerName, x, y });
            }
            renderPlayersOnPitch();
        };

        // Event listener voor de knop om een speler toe te voegen
        addPlayerBtn.addEventListener('click', () => {
            addPlayerInput();
        });

        // Event listener om spelers te verwijderen (gedelegeerd)
        playersContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-player-btn')) {
                e.target.closest('.player-input').remove();
                updatePlayerChips();
            }
        });

        // Event listener voor de "Opslaan" knop
        saveReportBtn.addEventListener('click', () => {
            const matchDate = matchDateInput.value;
            const opponent = opponentInput.value;
            const homeScore = homeScoreInput.value;
            const awayScore = awayScoreInput.value;
            const generalComments = generalCommentsInput.value;

            if (!matchDate || !opponent) {
                showConfirmationModal('Vul alsjeblieft de datum en de tegenstander in.', () => {});
                return;
            }

            const players = [];
            document.querySelectorAll('.player-input').forEach(playerDiv => {
                const playerName = playerDiv.querySelector('.player-name').value;
                const playerComment = playerDiv.querySelector('.player-comment').value;
                if (playerName) {
                    players.push({ name: playerName, comment: playerComment });
                }
            });

            const newReport = {
                matchDate,
                opponent,
                homeScore,
                awayScore,
                generalComments,
                players,
                quarterPositions,
                quarterScores,
                timestamp: new Date().toISOString()
            };

            const savedReports = JSON.parse(localStorage.getItem('matchReports')) || [];
            savedReports.push(newReport);
            localStorage.setItem('matchReports', JSON.stringify(savedReports));

            showConfirmationModal('Het verslag is succesvol opgeslagen!', () => {
                clearForm();
                loadReports();
            });
        });

        // Event listener voor de "Wissen" knop
        clearFormBtn.addEventListener('click', () => {
            showConfirmationModal('Weet je zeker dat je het formulier wilt wissen? Alle ingevoerde gegevens gaan verloren.', () => {
                clearForm();
            });
        });

        // Event listener voor de "Bekijken" knop (gedelegeerd)
        reportsList.addEventListener('click', (e) => {
            if (e.target.classList.contains('view-report-btn')) {
                const index = e.target.dataset.index;
                const savedReports = JSON.parse(localStorage.getItem('matchReports')) || [];
                const report = savedReports[index];
                if (report) {
                    matchDateInput.value = report.matchDate;
                    opponentInput.value = report.opponent;
                    generalCommentsInput.value = report.generalComments;

                    playersContainer.innerHTML = '';
                    if (report.players && report.players.length > 0) {
                        report.players.forEach(player => {
                            addPlayerInput(player.name, player.comment);
                        });
                    } else {
                        addPlayerInput();
                    }

                    quarterPositions = report.quarterPositions || { 'q1': [], 'q2': [], 'q3': [], 'q4': [] };
                    quarterScores = report.quarterScores || { 'q1': { home: 0, away: 0 }, 'q2': { home: 0, away: 0 }, 'q3': { home: 0, away: 0 }, 'q4': { home: 0, away: 0 } };
                    
                    // Vul de kwartscorevelden in
                    quarterScoreInputs.q1Home.value = quarterScores.q1.home;
                    quarterScoreInputs.q1Away.value = quarterScores.q1.away;
                    quarterScoreInputs.q2Home.value = quarterScores.q2.home;
                    quarterScoreInputs.q2Away.value = quarterScores.q2.away;
                    quarterScoreInputs.q3Home.value = quarterScores.q3.home;
                    quarterScoreInputs.q3Away.value = quarterScores.q3.away;
                    quarterScoreInputs.q4Home.value = quarterScores.q4.home;
                    quarterScoreInputs.q4Away.value = quarterScores.q4.away;

                    // Update de totale score
                    calculateTotalScore();
                    quarterSelect.value = 'q1';
                    renderPlayersOnPitch();

                    showConfirmationModal('Opgeslagen verslag geladen in het formulier.', () => {});
                }
            } else if (e.target.classList.contains('delete-report-btn')) {
                const index = e.target.dataset.index;
                showConfirmationModal('Weet je zeker dat je dit verslag wilt verwijderen?', () => {
                    let savedReports = JSON.parse(localStorage.getItem('matchReports')) || [];
                    savedReports.splice(index, 1);
                    localStorage.setItem('matchReports', JSON.stringify(savedReports));
                    loadReports();
                });
            }
        });

        // Event listeners voor het updaten van de kwartscores
        document.querySelectorAll('.quarter-score-input').forEach(input => {
            input.addEventListener('input', (e) => {
                const id = e.target.id;
                const value = parseInt(e.target.value) || 0;
                
                if (id.includes('q1')) { quarterScores.q1[id.includes('Home') ? 'home' : 'away'] = value; }
                if (id.includes('q2')) { quarterScores.q2[id.includes('Home') ? 'home' : 'away'] = value; }
                if (id.includes('q3')) { quarterScores.q3[id.includes('Home') ? 'home' : 'away'] = value; }
                if (id.includes('q4')) { quarterScores.q4[id.includes('Home') ? 'home' : 'away'] = value; }
                
                calculateTotalScore();
            });
        });

        // Drag-and-drop functionaliteit voor de spelerchips
        playerChipsContainer.addEventListener('dragstart', (e) => {
            draggingPlayer = e.target.dataset.playerName;
        });

        pitchSvg.addEventListener('dragover', (e) => {
            e.preventDefault();
            pitchSvg.classList.add('player-placeholder');
        });

        pitchSvg.addEventListener('dragleave', () => {
            pitchSvg.classList.remove('player-placeholder');
        });

        pitchSvg.addEventListener('drop', (e) => {
            e.preventDefault();
            pitchSvg.classList.remove('player-placeholder');
            const rect = pitchSvg.getBoundingClientRect();
            const x = (e.clientX - rect.left) / rect.width * 100;
            const y = (e.clientY - rect.top) / rect.height * 65;
            
            if (draggingPlayer) {
                updatePlayerPosition(draggingPlayer, x, y);
            }
            draggingPlayer = null;
        });

        // Touch functionaliteit voor mobiele apparaten
        let touchPlayer = null;
        pitchSvg.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const target = touch.target.closest('.draggable-player');
            if (target) {
                touchPlayer = target.dataset.playerName;
            }
        });

        pitchSvg.addEventListener('touchmove', (e) => {
            if (touchPlayer) {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = pitchSvg.getBoundingClientRect();
                const x = (touch.clientX - rect.left) / rect.width * 100;
                const y = (touch.clientY - rect.top) / rect.height * 65;
                updatePlayerPosition(touchPlayer, x, y);
            }
        });

        pitchSvg.addEventListener('touchend', (e) => {
            touchPlayer = null;
        });

        // Event listener voor het veranderen van het kwartier
        quarterSelect.addEventListener('change', () => {
            renderPlayersOnPitch();
        });
        
        // Luister naar wijzigingen in de spelersnamen om de chips te updaten
        playersContainer.addEventListener('input', updatePlayerChips);

        // Initialisatie bij het laden van de pagina
        document.addEventListener('DOMContentLoaded', () => {
            addPlayerInput();
            loadReports();
            updatePlayerChips();
            renderPlayersOnPitch();
            calculateTotalScore();
        });
    </script>
</body>
</html>
